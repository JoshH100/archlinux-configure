- name: check if paserve is installed
  shell: pacman -Q pacserve
  register: pac_pacserve

- name: Setup pacman.conf
  template:
    src: pacman.conf.j2
    dest: /etc/pacman.conf
    #  ignore_errors: yes

- name: deploy mirrors.conf and mirrorlist
  block:
    - template: src=mirrors.conf.j2 dest=/etc/pacman.d/mirrors.conf
    - copy: src=mirrorlist dest=/etc/pacman.d/mirrorlist

- include_tasks: gpg.yml
  loop: "{{ pacmankeys|flatten(levels=1) }}"
  tags: [pacmankey]
  
- import_tasks: pacserve.yml
  tags: [pacserve]

- name: Create pacman.d hook folder
  file:
    path: /etc/pacman.d/hooks
    state: directory
    owner: root
    
- name: Setup paccache hook
  copy:
    src: paccache.hook
    dest: /etc/pacman.d/hooks/paccache.hook
